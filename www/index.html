  <!DOCTYPE html>
  <html>
  <head>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script src="https://js.pusher.com/4.4/pusher.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/index.css">

    <link rel="stylesheet" type="text/css" href="css/onsen/onsenui.css">
    <link rel="stylesheet" type="text/css" href="css/onsen/onsen-css-components.min.css">


    <title>Gpark</title>
  </head>
  <body>
    <div class="app" hidden>
      <h1>Apache Cordova</h1>
      <div id="deviceready" class="blink">
        <p class="event listening">Connecting to Device</p>
        <p class="event received">Device is Ready</p>
      </div>
    </div>

    <ons-splitter>
      <ons-splitter-side id="menu" side="left" width="300px" collapse>
        <ons-page>
          <div class="background" style="background-color: white"></div>
          <ons-list>
            <ons-list-item modifier="longdivider" style="background-image: url('img/bg-pattern.png'); background-size: 100% 100%; height: 100px; color: white;  " >
              <ons-row>
                <ons-col width="75%" style="padding-top: 3%; ">
                  <p style="font-size: 20px; font-weight: 700" id="userFullname"></p>
                  <p style="margin-top: -9%" id="userTag"></p>
                </ons-col>
                <ons-col width="25%" style="padding-top: 12%;padding-right: 7%; text-align: right; " >
                  <i class="fa fa-ellipsis-v" style="font-size: 15px;"></i>
                </ons-col>
              </ons-row>
                           <!--  <div class="left">
                                <img class="list-item__thumbnail" src="img/user-icon.png">
                            </div>
                            <div class="center">
                                <span class="list-item__title">Cutest kitty</span><span class="list-item__subtitle"></span>
                            </div>
                            <div class="right" >
                                <i class="fa fa-ellipsis-v"></i>
                              </div> -->
                            </ons-list-item>

                            <ons-list-item onclick="fn.load('home.html');" tappable modifier="nodivider" id="nav-home" class="active-state">
                              <div class="left"><i class="fa fa-road" style="padding-right: 2px; opacity: 0.8"></i></div>
                              <div class="center" style="font-weight: 700; opacity: 0.8">Map</div> 
                            </ons-list-item>

                            <ons-list-item onclick="accountNav()" tappable  modifier="nodivider"  id="nav-account">
                              <div class="left"><i class="fa fa-user" style="padding-right: 2px; opacity: 0.8 "></i></div>
                              <div class="center" style="font-weight: 700;  opacity: 0.8">Account</div>
                            </ons-list-item>

                            <!-- <ons-list-item onclick="" tappable  modifier="nodivider"  id="nav-history">
                              <div class="left"><i class="fa fa-history" style="padding-right: 2px;  opacity: 0.8 "></i></div>
                              <div class="center" style="font-weight: 700; opacity: 0.8">History</div>
                            </ons-list-item>

                            <ons-list-item onclick="" tappable  modifier="nodivider"  id="nav-favorites">
                              <div class="left"><i class="fa fa-bookmark"  style="padding-right: 2px; opacity: 0.8 "></i></div>
                              <div class="center" style="font-weight: 700; opacity: 0.8">Favorites</div>
                            </ons-list-item> -->

                            <ons-list-item onclick="" tappable  modifier="nodivider"  id="nav-help">
                              <div class="left"><i class="fa fa-question" style="padding-right: 2px; opacity: 0.8"></i></div>
                              <div class="center" style="font-weight: 700; opacity: 0.8">Help</div>
                            </ons-list-item>

                            <ons-list-item onclick="" tappable  modifier="longdivider"  id="nav-settings">
                              <div class="left"><i class="fa fa-cog" style="padding-right: 2px; opacity: 0.8"></i></div>
                              <div class="center" style="font-weight: 700; opacity: 0.8">Settings</div>
                            </ons-list-item>

                            <ons-list-item onclick="logOut();" tappable  modifier="longdivider" id="nav-logout">
                              <div class="left" id="left-log"></div>
                              <div class="center" style="font-weight: 700; opacity: 0.8" id="center-log"></div>

                            </ons-list-item>
                          </ons-list>
                        </ons-page>
                      </ons-splitter-side>
                      <ons-splitter-content>
                        <ons-navigator id="myNavigator" page="home.html" animation="slide"></ons-navigator>
                      </ons-splitter-content>
                    </ons-splitter>



                    <template id="home.html">
                      <ons-page id="home">
                        <ons-toolbar>
                          <div class="center">
                            Map
                          </div>
                          <div class="left">
                            <ons-toolbar-button onclick="fn.open()">
                              <ons-icon icon="md-menu"></ons-icon>
                            </ons-toolbar-button>
                          </div>
                          <div class="right">
                            <ons-toolbar-button  onclick="myNavigator.pushPage('templates/notification.html')">
                              <ons-icon icon="fa-bell" style="color: white;"></ons-icon>
                            </ons-toolbar-button>
                          </div>
                        </ons-toolbar>
                        <div id="map" style="height: 100%; width: 100%; "></div>



                      </ons-page>

                    </template>









                    <script type="text/javascript" src="cordova.js"></script>


                    <script type="text/javascript" src="js/onsen/onsenui.min.js"></script>

                    <script type="text/javascript">
                      $
                    </script>

                    <script type="text/javascript">

                      document.addEventListener('deviceready', function () {

                        console.log("OneSignal");
    // Enable to debug issues.
    // window.plugins.OneSignal.setLogLevel({logLevel: 4, visualLevel: 4});
    var notificationOpenedCallback = function(jsonData) {
      console.log('notificationOpenedCallback: ' + JSON.stringify(jsonData));
    };
    window.plugins.OneSignal
    .startInit("d1a63136-9931-4264-82a4-293c0521c0dd")
    .handleNotificationOpened(notificationOpenedCallback)
    .endInit();
  }, false);
</script>
<script>


  var map;
  function initMap() {


    var icon = {
          url: "img/my_location_icon.png", // url
          scaledSize: new google.maps.Size(15, 15), // scaled size
          origin: new google.maps.Point(0,0), // origin
          anchor: new google.maps.Point(0, 0) // anchor
        };
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 14.832665, lng: 120.282720},
          zoom: 13,
          disableDefaultUI: true,
          gestureHandling: 'greedy',
          styles:[
          {
            "featureType": "all",
            "elementType": "all",
            "stylers": [
            {
              "saturation": "32"
            },
            {
              "lightness": "-3"
            },
            {
              "visibility": "on"
            },
            {
              "weight": "1.18"
            }
            ]
          },
          {
            "featureType": "administrative",
            "elementType": "labels",
            "stylers": [
            {
              "visibility": "off"
            }
            ]
          },
          {
            "featureType": "landscape",
            "elementType": "labels",
            "stylers": [
            {
              "visibility": "off"
            }
            ]
          },
          {
            "featureType": "landscape.man_made",
            "elementType": "all",
            "stylers": [
            {
              "saturation": "-70"
            },
            {
              "lightness": "14"
            }
            ]
          },
          {
            "featureType": "poi",
            "elementType": "labels",
            "stylers": [
            {
              "visibility": "off"
            }
            ]
          },
          {
            "featureType": "road",
            "elementType": "labels",
            "stylers": [
            {
              "visibility": "on"
            }
            ]
          },
          {
            "featureType": "transit",
            "elementType": "labels",
            "stylers": [
            {
              "visibility": "off"
            }
            ]
          },
          {
            "featureType": "water",
            "elementType": "all",
            "stylers": [
            {
              "saturation": "100"
            },
            {
              "lightness": "-14"
            }
            ]
          },
          {
            "featureType": "water",
            "elementType": "labels",
            "stylers": [
            {
              "visibility": "off"
            },
            {
              "lightness": "12"
            }
            ]
          }
          ]


        });
        var infowindow = new google.maps.InfoWindow();        
        setMarkers(map);


        function  setMarkers(map){
          console.log("Working")
          var freePark = {
            url: "img/free-park.png", // url
            scaledSize: new google.maps.Size(25, 25), // scaled size
            origin: new google.maps.Point(0,0), // origin
            anchor: new google.maps.Point(0, 0) // anchor

          };

          var paidPark = {
            url: "img/paid-park.png", // url
            scaledSize: new google.maps.Size(25, 25), // scaled size
            origin: new google.maps.Point(0,0), // origin
            anchor: new google.maps.Point(0, 0) // anchor

          };
          
          $.getJSON("https://www.gcccsbsit.xyz/_gpark/_api/select/s_geoLocation.php", function(data){


            for (var i =0; i < data.length; i++) {
              console.log(data[i].D_Type);
              if (data[i].D_Type == "Free") {
                var marker = new google.maps.Marker({
                  position: new google.maps.LatLng(data[i].D_Lat,data[i].D_Lng),
                  map: map,
                  icon: freePark,
                });
              }

              if (data[i].D_Type == "Paid") {
                var marker = new google.maps.Marker({
                  position: new google.maps.LatLng(data[i].D_Lat,data[i].D_Lng),
                  map: map,
                  icon: paidPark,
                });

              }

              google.maps.event.addListener(marker, 'click', (function (marker, i) {
                return function () {
                  var getLat = marker.getPosition().lat();
                  var getLng = marker.getPosition().lng();
                  var getId = data[i].D_Id;
                  var profile = "templates/park_profile.html";
                  infowindow.setContent("<button class='button button--material--flat' onclick='viewLocation("+getLat+","+getLng+","+getId+")'>View</button>");
                  infowindow.open(map, marker);

                  
                  

                  
                  

                }
              })(marker, i)); 

            }
          });

        }





          // Try HTML5 geolocation.
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
              var marker = new google.maps.Marker({
                position: pos,
                map: map,
                icon: icon,

              });

              


            }, function() {
              handleLocationError(true, infoWindow, map.getCenter());
            });
          } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
          }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          alert("Error");
        }


        function viewLocation(lat,lng,id){

          myNavigator.pushPage('templates/park_profile.html');
          localStorage.setItem("getLat", lat);
          localStorage.setItem("getLng", lng);
          localStorage.setItem("getId", id);
        }


        function logChecker(){
          if (localStorage.length == 0) {
           document.getElementById("userFullname").innerHTML = "Welcome to Gpark";
           document.getElementById("userTag").innerHTML = " ";

         }
         else{
          var username = localStorage.getItem("username");
          var password = localStorage.getItem("password");


          $.post("https://www.gcccsbsit.xyz/_gpark/_api/select/s_loginUser.php",{username:username, password:password},function(data){
            document.getElementById("userFullname").innerHTML = data[0].U_fname+" "+data[0].U_Lname;
            document.getElementById("userTag").innerHTML =  "@"+data[0].U_username;
          });


          document.getElementById("left-log").innerHTML = '<i class="fa fa-sign-out-alt" style="padding-right: 2px; opacity: 0.8"></i>';
           document.getElementById("center-log").innerHTML = 'Logout';

          
        }
      }


      function accountNav(){
        if (localStorage.length == 0) {
          fn.load('templates/account.html');

        }
        else{
         fn.load('templates/profile.html');
       }
     }



     function logOut(){
      ons.notification.toast('Logging Out Please Wait...', { timeout: 3000,
       });
      localStorage.clear()

      setTimeout(function(){ navigator.app.exitApp(); }, 3000);
      
      
      
     }

     logChecker();








   </script>
   <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBh33n9_kf42Ltk1HBKF1MRaJG6LA6Y754&callback=initMap" async defer></script>
   <script type="text/javascript" src="js/index.js"></script>
   <script type="text/javascript" src="js/custom-script.js"></script>
   <script type="text/javascript" src="js/moment.js"></script>

 </body>
 </html>
